<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoinPay</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" href="in.jpg" type="image/png">

</head>
<body>
    <!-- ------------------ الهيدر ------------------ -->
    <header class="header">
        <div class="header-right">
            <img src="ppp.jpg" alt="header image">
            <div class="divider"></div>
        </div>
      <!-- زر واتساب للتواصل -->
 <a href="https://wa.me/?text=مرحبًا%20مروان،%20شُفت%20الموقع%20بتاعك%20وعايز%20أتواصل%20معاك"
 target="_blank" 
 class="whatsapp-btn">
 <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</a>
    </header>

    <!-- ------------------ الفورم ------------------ -->
    <div class="container">
        <!-- تسجيل دخول -->
        <form id="login-form" class="form">
            <h2 class="login">Login</h2>
            <input type="text" id="login-username" placeholder="Username" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="button" id="loginBtn">Login</button>
            <button type="button" id="Cancel">Cancel</button>
            <p class="switch">مستخدم جديد؟ <span id="show-signup">سجل هنا</span></p>
            <p class="error" id="login-error"></p>
        </form>

        <!-- تسجيل جديد -->
        <form id="signup-form" class="form hidden">
            <h2 class="n">تسجيل جديد</h2>
            <input type="text" id="signup-username" placeholder="Username" required>
            <input type="password" id="signup-password" placeholder="Password" required>
            <button type="button" id="registerBtn">سجل</button>
            <p class="switch">لديك حساب؟ <span id="show-login">سجل دخول</span></p>
            <p class="error" id="signup-error"></p>
        </form>
    </div>

    <!-- ------------------ الجافاسكريبت ------------------ -->
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9mzy7VtnJV28qawDMYYEfTr8guf9Z5hQ",
  authDomain: "coinpay-3f182.firebaseapp.com",
  databaseURL: "https://coinpay-3f182-default-rtdb.firebaseio.com",
  projectId: "coinpay-3f182",
  storageBucket: "coinpay-3f182.firebasestorage.app",
  messagingSenderId: "9785521136",
  appId: "1:9785521136:web:117b57499cb35ba5db6335",
  measurementId: "G-M8DJXP3ZTG"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ------------------ عناصر الصفحة ------------------
const loginForm = document.getElementById("login-form");
const signupForm = document.getElementById("signup-form");
const showSignup = document.getElementById("show-signup");
const showLogin = document.getElementById("show-login");
const loginUser = document.getElementById("login-username");
const loginPass = document.getElementById("login-password");
const loginBtn = document.getElementById("loginBtn");
const loginError = document.getElementById("login-error");
const signupUser = document.getElementById("signup-username");
const signupPass = document.getElementById("signup-password");
const registerBtn = document.getElementById("registerBtn");
const signupError = document.getElementById("signup-error");
const cancelBtn = document.getElementById("Cancel");

// ------------------ تبديل الفورم ------------------
showSignup.onclick = ()=>{
    loginForm.classList.add("hidden");
    signupForm.classList.remove("hidden");
    loginError.textContent = "";
};
showLogin.onclick = ()=>{
    signupForm.classList.add("hidden");
    loginForm.classList.remove("hidden");
    signupError.textContent = "";
};

// ------------------ تسجيل مستخدم جديد ------------------
registerBtn.onclick = ()=>{
    signupError.textContent="";
    const u = signupUser.value.trim();
    const p = signupPass.value.trim();
    if(!u || !p){ signupError.textContent="الرجاء إدخال كل البيانات"; return; }

    get(child(ref(db), 'users/'+u)).then(snapshot=>{
        if(snapshot.exists()){ signupError.textContent="اليوزر موجود بالفعل"; return; }
        set(ref(db,'users/'+u), { password:p, balance:1000 }).then(()=>{
            alert("تم التسجيل ✅");
            signupForm.classList.add("hidden");
            loginForm.classList.remove("hidden");
        });
    });
};

// ------------------ تسجيل دخول ------------------
loginBtn.onclick = ()=>{
    loginError.textContent="";
    const u = loginUser.value.trim();
    const p = loginPass.value.trim();
    if(!u || !p){ loginError.textContent="الرجاء إدخال كل البيانات"; return; }

    get(child(ref(db), 'users/'+u)).then(snapshot=>{
        if(!snapshot.exists()){ loginError.textContent="المستخدم غير موجود"; return; }
        if(snapshot.val().password !== p){ loginError.textContent="كلمة السر غير صحيحة"; return; }

        localStorage.setItem("currentUser", u);

        // ------------------ هنا نميز بين المالك واللاعب العادي ------------------
        if(u === "coin" && p === "0000"){
            window.location.href="owner.html"; // المالك
        } else {
            window.location.href="game.html"; // اللاعبين العاديين
        }
    });
};

// ------------------ زرار Cancel ------------------
cancelBtn.onclick = ()=>{
    loginUser.value="";
    loginPass.value="";
    loginError.textContent="";
};
    </script>
</body>
</html>